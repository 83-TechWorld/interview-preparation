```md
# ðŸš¦ Rate Limiting Algorithms  
## Token Bucket & Leaky Bucket â€” Why, Where, and How They Are Used

Rate limiting algorithms protect systems from **traffic spikes**, **abuse**, and the **thundering herd problem** by controlling how fast requests are allowed to proceed.

---

## â“ Why Do We Need Rate Limiting?

Without rate limiting:
- One user or service can overload your API
- Sudden traffic spikes can crash databases
- Retry storms amplify failures

Rate limiting ensures:
- **Fair usage**
- **System stability**
- **Predictable performance**

---

# ðŸª£ Token Bucket Algorithm

## ðŸ§  Concept (Simple Explanation)

Imagine a bucket:
- Tokens are added at a **fixed rate**
- Each request **consumes one token**
- If no token â†’ request is rejected or delayed

âœ… Allows **bursts**  
âŒ Still enforces long-term rate

---

## ðŸ“Š How Token Bucket Works

```

Tokens added periodically
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TOKEN    â”‚
â”‚  BUCKET   â”‚
â”‚ (capacity)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
Request consumes 1 token

```

### Key Parameters

| Parameter | Meaning |
|--------|--------|
| Capacity | Max tokens bucket can hold |
| Refill rate | Tokens added per second |
| Cost | Tokens per request |

---

## ðŸ§ª Example

- Capacity: `10`
- Refill rate: `1 token/sec`

Scenario:
- 10 requests instantly â†’ allowed
- 11th request â†’ rejected
- After 1 sec â†’ 1 new request allowed

---

## ðŸ“ Where Token Bucket Is Used

| Use Case | Reason |
|-------|-------|
API Gateways | Allow bursts but limit abuse |
Mobile apps | Handle intermittent network |
Public APIs | Fair client usage |
Microservices | Prevent cascading overload |

---

## ðŸ›  Tools That Use Token Bucket

| Tool | Where |
|----|----|
NGINX | `limit_req` |
Envoy | Rate limit filter |
AWS API Gateway | Throttling |
Istio | Ingress rate limiting |
Redis | Custom implementations |

---

## ðŸ§± Data Structures Used

- **Counter + timestamp**
- **Redis INCR + TTL**
- **Atomic variables**
- **Sliding window approximation**

---

# ðŸš° Leaky Bucket Algorithm

## ðŸ§  Concept (Simple Explanation)

Imagine a bucket with a **small hole**:
- Requests enter bucket
- Bucket drains at a **constant rate**
- If bucket overflows â†’ requests dropped

âœ… Smooth output  
âŒ No bursts

---

## ðŸ“Š How Leaky Bucket Works

```

Requests â†’ Bucket â†’ Constant Output Rate â†’ Backend

```

### Key Parameters

| Parameter | Meaning |
|--------|--------|
| Capacity | Max queued requests |
| Leak rate | Requests per second |

---

## ðŸ§ª Example

- Capacity: `5`
- Leak rate: `1 req/sec`

Scenario:
- 10 incoming requests quickly
- First 5 queued
- Remaining 5 dropped
- Requests processed evenly at 1/sec

---

## ðŸ“ Where Leaky Bucket Is Used

| Use Case | Reason |
|-------|-------|
Network shaping | Smooth traffic |
Streaming | Stable throughput |
Ingress proxies | Prevent backend spikes |
IoT systems | Predictable flow |

---

## ðŸ›  Tools That Use Leaky Bucket

| Tool | Where |
|----|----|
NGINX | `limit_conn` |
Linux TC | Network traffic control |
Cloudflare | Edge protection |
HAProxy | Connection throttling |

---

## ðŸ§± Data Structures Used

- **Queue**
- **Fixed-size buffer**
- **Circular buffer**
- **Delay queues**

---

# ðŸ†š Token Bucket vs Leaky Bucket

| Feature | Token Bucket | Leaky Bucket |
|------|-------------|-------------|
Burst allowed | âœ… Yes | âŒ No |
Traffic smoothing | âŒ No | âœ… Yes |
Latency | Low | Higher |
Complexity | Medium | Simple |
Best for | APIs | Networks |

---

## ðŸŽ¯ Which One Should You Use?

| Scenario | Best Choice |
|--------|-------------|
Public API | Token Bucket |
Payment APIs | Token Bucket |
Network shaping | Leaky Bucket |
Streaming pipelines | Leaky Bucket |
Ingress control | Combination |

---

## ðŸ§© Real-World Architecture

```

Client
â†“
API Gateway (Token Bucket)
â†“
Queue (Leaky Bucket)
â†“
Worker Pool
â†“
Database

```

---

## ðŸ§  Key Design Rule

> **Token Bucket controls how fast users can talk.  
Leaky Bucket controls how fast systems listen.**

---

## ðŸ“¦ Libraries & Implementations

### Java
- Resilience4j RateLimiter
- Bucket4j
- Guava RateLimiter

### Node.js
- rate-limiter-flexible
- express-rate-limit

### Go
- golang.org/x/time/rate

### Distributed
- Redis
- Envoy
- Istio

---

## ðŸš€ Advanced Patterns

- Token Bucket + Redis (global rate limit)
- Hierarchical buckets (org â†’ user â†’ API)
- Adaptive rate limiting (based on CPU / latency)

---
